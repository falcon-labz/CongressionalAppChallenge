<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>SafeRoute + CareCompass ‚Äî Safety & Care Companion</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" crossorigin=""/>
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" crossorigin=""></script>
  <style>
    :root{--brand:#2563eb;--accent:#06b6d4}
    .glass{backdrop-filter:saturate(150%) blur(8px); background: rgba(255,255,255,.7)}
    .tab-active{background:var(--brand);color:white}
    .hold-ring{transition: stroke-dashoffset .12s linear}
    body.text-lg{font-size:1.125rem}
  </style>
</head>
<body class="min-h-screen bg-gradient-to-b from-slate-50 to-slate-100 text-slate-800">
  <header class="sticky top-0 z-30 border-b border-slate-200 bg-white/80 backdrop-blur">
    <div class="mx-auto max-w-6xl px-4 py-3 flex items-center justify-between">
      <div class="flex items-center gap-3">
        <div class="h-10 w-10 rounded-2xl bg-blue-600 grid place-items-center text-white font-bold">SC</div>
        <div>
          <h1 class="text-lg font-semibold">SafeRoute + CareCompass</h1>
          <p class="text-xs text-slate-500 -mt-1">Personal safety, health reminders, and local care resources ‚Äî privacy-first.</p>
        </div>
      </div>
      <div class="flex items-center gap-2">
        <button id="contrastBtn" class="px-3 py-2 rounded-xl border text-sm">High Contrast</button>
        <button id="textBtn" class="px-3 py-2 rounded-xl border text-sm">Large Text</button>
      </div>
    </div>
  </header>

  <main class="mx-auto max-w-6xl p-4 grid gap-4">
    <nav class="grid grid-cols-3 md:grid-cols-8 gap-2">
      <button class="tab tab-active rounded-2xl py-2 font-medium" data-tab="dashboard">Dashboard</button>
      <button class="tab rounded-2xl py-2 font-medium" data-tab="route">Safe Route</button>
      <button class="tab rounded-2xl py-2 font-medium" data-tab="care">Care Compass</button>
      <button class="tab rounded-2xl py-2 font-medium" data-tab="meds">Meds & Alerts</button>
      <button class="tab rounded-2xl py-2 font-medium" data-tab="checkin">Check‚ÄëIn</button>
      <button class="tab rounded-2xl py-2 font-medium" data-tab="report">Report Hazard</button>
      <button class="tab rounded-2xl py-2 font-medium" data-tab="resources">Resources</button>
      <button class="tab rounded-2xl py-2 font-medium" data-tab="settings">Settings</button>
    </nav>

    <!-- Dashboard -->
    <section id="dashboard" class="grid gap-4 md:grid-cols-3">
      <div class="glass rounded-3xl p-6 shadow-sm">
        <h2 class="text-lg font-semibold mb-2">Quick SOS</h2>
        <p class="text-sm text-slate-600 mb-3">Hold the button to send a discreet SOS SMS with your location to trusted contacts.</p>
        <div class="flex items-center gap-6">
          <div class="relative">
            <svg width="140" height="140" viewBox="0 0 120 120" class="block">
              <circle cx="60" cy="60" r="54" stroke="#e2e8f0" stroke-width="12" fill="none"/>
              <circle id="holdProgress" cx="60" cy="60" r="54" stroke="var(--brand)" stroke-width="12" fill="none" stroke-linecap="round" stroke-dasharray="339.292" stroke-dashoffset="339.292" class="hold-ring"/>
            </svg>
            <button id="sosBtn" class="absolute inset-0 m-auto h-24 w-24 rounded-full bg-red-600 text-white text-2xl font-bold shadow">SOS</button>
          </div>
          <div class="text-sm">
            <div>Hold progress: <span id="holdPct" class="font-semibold">0%</span></div>
            <div class="mt-3 flex gap-2">
              <a href="tel:911" class="px-3 py-2 rounded-xl bg-red-50 text-red-700 border">Call 911</a>
              <button id="testSms" class="px-3 py-2 rounded-xl bg-blue-50 text-blue-700 border">Test</button>
            </div>
            <p class="text-xs text-slate-500 mt-3">Add trusted contacts in Settings.</p>
          </div>
        </div>
      </div>

      <div class="glass rounded-3xl p-6 shadow-sm">
        <h2 class="text-lg font-semibold mb-2">Today ‚Äî Appointments & Meds</h2>
        <div id="todayList" class="space-y-2 text-sm"></div>
        <div class="mt-3 text-right"><button id="goMeds" class="px-3 py-2 rounded-xl border">Manage Meds</button></div>
      </div>

      <div class="glass rounded-3xl p-6 shadow-sm">
        <h2 class="text-lg font-semibold mb-2">Mood & Check‚ÄëIns</h2>
        <div class="text-sm">Rate your mood now:</div>
        <div class="flex gap-2 mt-2">
          <button class="moodBtn px-3 py-2 rounded-xl border" data-val="1">üòû</button>
          <button class="moodBtn px-3 py-2 rounded-xl border" data-val="2">üòê</button>
          <button class="moodBtn px-3 py-2 rounded-xl border" data-val="3">üôÇ</button>
          <button class="moodBtn px-3 py-2 rounded-xl border" data-val="4">üòÉ</button>
        </div>
        <div id="moodLog" class="text-xs text-slate-500 mt-3"></div>
      </div>

      <div class="glass rounded-3xl p-6 shadow-sm md:col-span-3">
        <h2 class="text-lg font-semibold mb-3">Live Map ‚Äî Safety & Care Places</h2>
        <div id="map" class="h-72 rounded-2xl"></div>
      </div>

      <div class="glass rounded-3xl p-6 shadow-sm md:col-span-3">
        <h2 class="text-lg font-semibold mb-3">Recent Community Reports</h2>
        <div id="reportList" class="grid md:grid-cols-3 gap-3"></div>
      </div>
    </section>

    <!-- Safe Route -->
    <section id="route" class="hidden grid gap-4 md:grid-cols-5">
      <div class="glass rounded-3xl p-6 shadow-sm md:col-span-2">
        <h2 class="text-lg font-semibold mb-3">Plan a Safer Route</h2>
        <label class="text-sm">Start</label>
        <input id="startInput" class="w-full mt-1 mb-3 rounded-xl border p-2" placeholder="Start address"/>
        <label class="text-sm">Destination</label>
        <input id="endInput" class="w-full mt-1 mb-4 rounded-xl border p-2" placeholder="Destination address"/>
        <label class="text-sm">Preferences</label>
        <div class="grid grid-cols-2 gap-2 my-2 text-sm">
          <label class="flex items-center gap-2"><input type="checkbox" id="wellLit" checked> Well‚Äëlit</label>
          <label class="flex items-center gap-2"><input type="checkbox" id="avoidReports" checked> Avoid hazards</label>
          <label class="flex items-center gap-2"><input type="checkbox" id="nearCampus"> Near campus</label>
          <label class="flex items-center gap-2"><input type="checkbox" id="mainRoads" checked> Main roads</label>
        </div>
        <button id="planBtn" class="mt-2 w-full rounded-xl bg-blue-600 text-white py-2 font-medium">Generate Route</button>
        <div id="scoreWrap" class="mt-4 hidden">
          <div class="text-sm text-slate-600">Safety Score</div>
          <div id="safetyScore" class="text-3xl font-semibold">‚Äî</div>
          <p id="routeTips" class="text-sm text-slate-600 mt-1"></p>
        </div>
      </div>
      <div class="glass rounded-3xl p-3 shadow-sm md:col-span-3">
        <div id="routeMap" class="h-[450px] rounded-2xl"></div>
      </div>
    </section>

    <!-- Care Compass -->
    <section id="care" class="hidden grid gap-4 md:grid-cols-3">
      <div class="glass rounded-3xl p-6 shadow-sm">
        <h2 class="text-lg font-semibold mb-3">Symptom Checker (Quick)</h2>
        <input id="symInput" class="w-full rounded-xl border p-2" placeholder="e.g., headache, fever"/>
        <button id="symCheck" class="mt-3 w-full rounded-xl bg-emerald-600 text-white py-2">Check</button>
        <div id="symResult" class="mt-3 text-sm text-slate-600"></div>
      </div>

      <div class="glass rounded-3xl p-6 shadow-sm">
        <h2 class="text-lg font-semibold mb-3">Telehealth Quick Links</h2>
        <div class="grid gap-2 text-sm">
          <a class="p-3 rounded-xl border" target="_blank" href="https://nc.gov/">Local Health Services</a>
          <a class="p-3 rounded-xl border" target="_blank" href="https://www.healthline.com/">Healthline</a>
          <a class="p-3 rounded-xl border" target="_blank" href="https://www.mentalhealth.gov/">Mental Health Resources</a>
        </div>
      </div>

      <div class="glass rounded-3xl p-6 shadow-sm">
        <h2 class="text-lg font-semibold mb-3">Quick Care Actions</h2>
        <div class="grid gap-2 text-sm">
          <button id="findClinic" class="p-3 rounded-xl border">Find Nearest Clinic</button>
          <button id="callCrisis" class="p-3 rounded-xl border">Call 24/7 Crisis Line</button>
          <button id="bookRide" class="p-3 rounded-xl border">Request Non‚ÄëEmergency Ride</button>
        </div>
      </div>

      <div class="glass rounded-3xl p-6 shadow-sm md:col-span-3">
        <h2 class="text-lg font-semibold mb-3">Health Timeline</h2>
        <div id="timeline" class="text-sm"></div>
      </div>
    </section>

    <!-- Meds & Alerts -->
    <section id="meds" class="hidden grid gap-4 md:grid-cols-2">
      <div class="glass rounded-3xl p-6 shadow-sm">
        <h2 class="text-lg font-semibold mb-3">Medication Reminders</h2>
        <div class="flex gap-2 mb-3">
          <input id="medName" class="flex-1 rounded-xl border p-2" placeholder="Medicine name"/>
          <input id="medTime" type="time" class="rounded-xl border p-2"/>
          <button id="addMed" class="px-4 rounded-xl bg-slate-800 text-white">Add</button>
        </div>
        <ul id="medList" class="space-y-2 text-sm"></ul>
      </div>
      <div class="glass rounded-3xl p-6 shadow-sm">
        <h2 class="text-lg font-semibold mb-3">Appointments</h2>
        <div class="flex gap-2 mb-3">
          <input id="apptName" class="flex-1 rounded-xl border p-2" placeholder="Doctor / Service"/>
          <input id="apptDate" type="date" class="rounded-xl border p-2"/>
          <button id="addAppt" class="px-4 rounded-xl border">Add</button>
        </div>
        <ul id="apptList" class="space-y-2 text-sm"></ul>
      </div>
    </section>

    <!-- Check-In -->
    <section id="checkin" class="hidden grid gap-4 md:grid-cols-2">
      <div class="glass rounded-3xl p-6 shadow-sm">
        <h2 class="text-lg font-semibold mb-3">Scheduled Check‚ÄëIn</h2>
        <p class="text-sm text-slate-600 mb-3">If you miss a check‚Äëin, the app prepares a message to trusted contacts with your last location.</p>
        <div class="flex items-end gap-3">
          <div>
            <label class="text-sm">Minutes</label>
            <input id="mins" type="number" min="1" value="15" class="w-24 mt-1 rounded-xl border p-2"/>
          </div>
          <button id="startTimer" class="h-10 px-4 rounded-xl bg-blue-600 text-white font-medium">Start</button>
          <button id="cancelTimer" class="h-10 px-4 rounded-xl border">Cancel</button>
        </div>
        <div class="mt-4 text-2xl font-semibold" id="timeLeft">‚Äî</div>
      </div>

      <div class="glass rounded-3xl p-6 shadow-sm">
        <h2 class="text-lg font-semibold mb-3">Trusted Contacts</h2>
        <div class="flex gap-2 mb-3">
          <input id="contactName" class="flex-1 rounded-xl border p-2" placeholder="Name"/>
          <input id="contactPhone" class="flex-1 rounded-xl border p-2" placeholder="Phone"/>
          <button id="addContact" class="px-4 rounded-xl bg-slate-800 text-white">Add</button>
        </div>
        <ul id="contactList" class="space-y-2 text-sm"></ul>
      </div>
    </section>

    <!-- Report Hazard -->
    <section id="report" class="hidden grid gap-4 md:grid-cols-2">
      <div class="glass rounded-3xl p-6 shadow-sm">
        <h2 class="text-lg font-semibold mb-3">New Community Report</h2>
        <label class="text-sm">Type</label>
        <select id="reportType" class="w-full mt-1 mb-3 rounded-xl border p-2">
          <option>Poor lighting</option>
          <option>Suspicious activity</option>
          <option>Harassment</option>
          <option>Stray animal</option>
          <option>Road hazard</option>
          <option>Other</option>
        </select>
        <label class="text-sm">Description</label>
        <textarea id="reportDesc" rows="4" class="w-full mt-1 mb-3 rounded-xl border p-2" placeholder="What happened?" ></textarea>
        <button id="useLocation" class="mb-3 px-3 py-2 rounded-xl border">Use my current location</button>
        <div class="grid grid-cols-2 gap-2">
          <input id="lat" class="rounded-xl border p-2" placeholder="Latitude"/>
          <input id="lng" class="rounded-xl border p-2" placeholder="Longitude"/>
        </div>
        <button id="saveReport" class="mt-4 w-full rounded-xl bg-blue-600 text-white py-2 font-medium">Save Report</button>
        <p class="text-xs text-slate-500 mt-2">Reports are stored locally. For emergencies, call 911.</p>
      </div>
      <div class="glass rounded-3xl p-3 shadow-sm">
        <div id="reportMap" class="h-[450px] rounded-2xl"></div>
      </div>
    </section>

    <!-- Resources -->
    <section id="resources" class="hidden glass rounded-3xl p-6 shadow-sm">
      <h2 class="text-lg font-semibold mb-3">Local Resources</h2>
      <div class="grid md:grid-cols-3 gap-3 mb-3 text-sm">
        <input id="resSearch" class="rounded-xl border p-2" placeholder="Search by name or service"/>
        <select id="resType" class="rounded-xl border p-2">
          <option value="">All Types</option>
          <option value="shelter">Shelter</option>
          <option value="clinic">Health Clinic</option>
          <option value="food">Food Bank</option>
          <option value="mental">Mental Health</option>
          <option value="legal">Legal Aid</option>
        </select>
        <select id="resArea" class="rounded-xl border p-2">
          <option value="">All Areas</option>
          <option>Raleigh</option>
          <option>Durham</option>
          <option>Chapel Hill</option>
          <option>Cary</option>
        </select>
      </div>
      <div id="resList" class="grid md:grid-cols-3 gap-3"></div>
    </section>

    <!-- Settings -->
    <section id="settings" class="hidden grid gap-4 md:grid-cols-2">
      <div class="glass rounded-3xl p-6 shadow-sm">
        <h2 class="text-lg font-semibold mb-3">Privacy & Safety</h2>
        <label class="flex items-center justify-between py-2"><span class="text-sm">Share location only when sending SOS</span><input id="privacyLoc" type="checkbox" checked class="h-5 w-5"/></label>
        <label class="flex items-center justify-between py-2"><span class="text-sm">Require long‚Äëpress for SOS</span><input id="requireHold" type="checkbox" checked class="h-5 w-5"/></label>
        <label class="flex items-center justify-between py-2"><span class="text-sm">Auto‚Äëopen SMS composer</span><input id="autoSms" type="checkbox" checked class="h-5 w-5"/></label>
      </div>
      <div class="glass rounded-3xl p-6 shadow-sm">
        <h2 class="text-lg font-semibold mb-3">District & Theme</h2>
        <select id="district" class="w-full mt-1 mb-3 rounded-xl border p-2">
          <option>NC‚Äë02 (Raleigh / Wake)</option>
          <option>NC‚Äë04 (Durham / Chapel Hill)</option>
        </select>
        <label class="text-sm">Theme</label>
        <select id="theme" class="w-full mt-1 mb-3 rounded-xl border p-2"><option value="light">Light</option><option value="dim">Dim</option><option value="dark">Dark</option></select>
        <button id="resetApp" class="mt-2 rounded-xl border px-4 py-2">Reset (clear local data)</button>
      </div>
    </section>

  </main>
  <footer class="mx-auto max-w-6xl p-4 text-center text-xs text-slate-500">Built for submission ‚Äî privacy-first, offline-ready, community impact.</footer>

<script>
// Simple local store
const storeKey = 'safe_compass_v1';
let state = JSON.parse(localStorage.getItem(storeKey) || '{"contacts":[],"reports":[],"meds":[],"appts":[],"mood":[],"settings":{"privacyLoc":true,"requireHold":true,"autoSms":true,"district":"NC-02"}}');
function save(){ localStorage.setItem(storeKey, JSON.stringify(state)); }
function toast(msg){ const t=document.createElement('div'); t.className='fixed bottom-4 left-1/2 -translate-x-1/2 px-4 py-2 rounded-xl bg-slate-900 text-white text-sm'; t.textContent=msg; document.body.appendChild(t); setTimeout(()=>t.remove(),1800); }

// Tabs
$$('.tab').forEach(btn=>btn.addEventListener('click',()=>{ $$('.tab').forEach(b=>b.classList.remove('tab-active')); btn.classList.add('tab-active'); const id=btn.dataset.tab; $$('main section').forEach(s=>s.classList.add('hidden')); document.getElementById(id).classList.remove('hidden'); }));

// Accessibility
$('#contrastBtn').addEventListener('click',()=>document.body.classList.toggle('contrast'));
$('#textBtn').addEventListener('click',()=>document.body.classList.toggle('text-lg'));

// Map init
let map, marker;
function initMap(){ map = L.map('map'); L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{maxZoom:19}).addTo(map);
  navigator.geolocation?.getCurrentPosition(p=>{ map.setView([p.coords.latitude,p.coords.longitude],13); marker=L.marker([p.coords.latitude,p.coords.longitude]).addTo(map).bindPopup('You are here'); }, ()=>{ map.setView([35.78,-78.64],12); }); }

// Reports
function renderRecent(){ const wrap = $('#reportList'); wrap.innerHTML=''; const recent = [...state.reports].reverse().slice(0,6); if(!recent.length){ wrap.innerHTML='<div class="text-sm text-slate-500">No reports yet.</div>'; return } recent.forEach(r=>{ const card=document.createElement('div'); card.className='rounded-2xl border p-3 bg-white'; card.innerHTML=`<div class="text-sm font-semibold">${r.type}</div><div class="text-xs text-slate-600 mt-1">${r.desc||''}</div><div class="text-xs text-slate-500 mt-2">${new Date(r.ts).toLocaleString()}</div>`; wrap.appendChild(card); }) }

// Contacts
function renderContacts(){ const list=$('#contactList'); list.innerHTML=''; if(!state.contacts.length){ list.innerHTML='<li class="text-sm text-slate-500">No contacts yet.</li>'; return } state.contacts.forEach((c,i)=>{ const li=document.createElement('li'); li.className='flex items-center justify-between rounded-xl border p-2'; li.innerHTML=`<div><div class="text-sm font-medium">${c.name}</div><div class="text-xs text-slate-600">${c.phone}</div></div><div class="flex gap-2"><a class="px-2 py-1 rounded border text-xs" href="sms:${c.phone}">SMS</a><button class="px-2 py-1 rounded border text-xs" data-del="${i}">Remove</button></div>`; list.appendChild(li); }); list.querySelectorAll('button[data-del]').forEach(btn=>btn.addEventListener('click',()=>{ const i=+btn.dataset.del; state.contacts.splice(i,1); save(); renderContacts(); toast('Removed'); })); }
$('#addContact').addEventListener('click',()=>{ const name=$('#contactName').value.trim(); const phone=$('#contactPhone').value.trim(); if(!name||!phone){ toast('Enter name & phone'); return } state.contacts.push({name,phone}); save(); $('#contactName').value=''; $('#contactPhone').value=''; renderContacts(); toast('Added'); });

// SOS hold
let holdTimer, holding=false; const HOLD_MS=3000; const circle = $('#holdProgress'); const circLen = 339.292;
function setProgress(p){ p=Math.max(0,Math.min(1,p)); circle.setAttribute('stroke-dashoffset', String(circLen*(1-p))); $('#holdPct').textContent=Math.round(p*100)+'%'; }
function sendSOS(test=false){ navigator.geolocation?.getCurrentPosition(pos=>{ const link=`https://maps.google.com/?q=${pos.coords.latitude},${pos.coords.longitude}`; const msg=encodeURIComponent((test? '[TEST] ': '')+'SOS. I need help. Location: '+link); if(!state.contacts.length){ toast('Add a trusted contact'); return } const to = state.contacts.map(c=>c.phone).join(','); const sms = `sms:${to}?&body=${msg}`; if(state.settings.autoSms) window.location.href = sms; else { navigator.clipboard?.writeText(decodeURIComponent(msg)); toast('Message copied'); } }, ()=>{ const msg=encodeURIComponent((test? '[TEST] ': '')+'SOS. I need help. Location unavailable.'); const to = state.contacts.map(c=>c.phone).join(','); const sms = `sms:${to}?&body=${msg}`; if(state.settings.autoSms) window.location.href = sms; else { navigator.clipboard?.writeText(decodeURIComponent(msg)); toast('Message copied'); } }); }
$('#sosBtn').addEventListener('mousedown',()=>{ if(!state.settings.requireHold){ sendSOS(); return } holding=true; const start=Date.now(); setProgress(0); holdTimer=setInterval(()=>{ const p=(Date.now()-start)/HOLD_MS; setProgress(p); if(p>=1){ clearInterval(holdTimer); holding=false; setProgress(1); sendSOS(false); } },50); }); ['mouseup','mouseleave','touchend'].forEach(ev=> $('#sosBtn').addEventListener(ev, ()=>{ if(holding){ clearInterval(holdTimer); setProgress(0); holding=false } })); $('#testSms').addEventListener('click',()=>sendSOS(true));

// Reports map
let reportMap, reportLayer;
function initReportMap(){ reportMap=L.map('reportMap').setView([35.78,-78.64],12); L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{maxZoom:19}).addTo(reportMap); reportLayer=L.layerGroup().addTo(reportMap); redrawReports(); }
function redrawReports(){ reportLayer.clearLayers(); state.reports.forEach(r=> L.marker([r.lat,r.lng]).addTo(reportLayer).bindPopup(`<b>${r.type}</b><br>${r.desc||''}`)); }
$('#useLocation').addEventListener('click',()=>{ navigator.geolocation?.getCurrentPosition(pos=>{ $('#lat').value=pos.coords.latitude.toFixed(6); $('#lng').value=pos.coords.longitude.toFixed(6); toast('Location added'); }, ()=>toast('Location unavailable')); });
$('#saveReport').addEventListener('click',()=>{ const type=$('#reportType').value; const desc=$('#reportDesc').value.trim(); const lat=parseFloat($('#lat').value); const lng=parseFloat($('#lng').value); if(Number.isNaN(lat)||Number.isNaN(lng)){ toast('Add valid lat & lng'); return } const rec={id:crypto.randomUUID(),type,desc,lat,lng,ts:Date.now()}; state.reports.push(rec); save(); redrawReports(); renderRecent(); toast('Report saved'); $('#reportDesc').value=''; $('#lat').value=''; $('#lng').value=''; });

// Route map (heuristic)
let routeMap, routeLayer, hazardLayer;
function initRouteMap(){ routeMap=L.map('routeMap').setView([35.78,-78.64],12); L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{maxZoom:19}).addTo(routeMap); hazardLayer=L.layerGroup().addTo(routeMap); drawHazards(); }
function drawHazards(){ hazardLayer.clearLayers(); state.reports.forEach(r=>{ L.circleMarker([r.lat,r.lng],{radius:6,color:'#dc2626'}).addTo(hazardLayer).bindPopup(`${r.type}<br>${r.desc||''}`); }); }
function randomOffset(){ return (Math.random()-.5)*0.02 }
$('#planBtn').addEventListener('click',()=>{ const a=[35.7796+randomOffset(),-78.6382+randomOffset()]; const b=[35.7726+randomOffset(),-78.6746+randomOffset()]; if(routeLayer) routeMap.removeLayer(routeLayer); const prefs={wellLit:$('#wellLit').checked,avoidReports:$('#avoidReports').checked,nearCampus:$('#nearCampus').checked,mainRoads:$('#mainRoads').checked}; let score=70; score += prefs.wellLit?8:-4; score += prefs.avoidReports?8:-6; score += prefs.nearCampus?4:0; score += prefs.mainRoads?6:-3; const mid=[(a[0]+b[0])/2,(a[1]+b[1])/2]; const nearby = state.reports.filter(r=>Math.hypot(r.lat-mid[0],r.lng-mid[1])<0.01).length; score -= nearby*4; score=Math.max(5,Math.min(99,Math.round(score))); routeLayer=L.polyline([a,mid,b],{color: 'var(--brand)', weight:6}).addTo(routeMap); routeMap.fitBounds(L.latLngBounds([a,b]).pad(0.3)); $('#scoreWrap').classList.remove('hidden'); $('#safetyScore').textContent=score; $('#routeTips').textContent = score>=85? 'Excellent lighting and main roads.' : score>=70? 'Good route. Stay alert near marked areas.' : 'Caution advised. Consider changing time or path.'; });

// Moods
$$('.moodBtn').forEach(b=>b.addEventListener('click',()=>{ const v=+b.dataset.val; state.mood.push({v,ts:Date.now()}); save(); renderMood(); toast('Mood saved'); }));
function renderMood(){ $('#moodLog').textContent = state.mood.slice(-5).map(m=>`${new Date(m.ts).toLocaleString()}: ${['üòû','üòê','üôÇ','üòÉ'][m.v-1]||m.v}`).join('\n'); }

// Meds & Appts
$('#addMed').addEventListener('click',()=>{ const name=$('#medName').value.trim(); const time=$('#medTime').value; if(!name||!time){ toast('Enter med and time'); return } state.meds.push({id:crypto.randomUUID(),name,time}); save(); $('#medName').value=''; $('#medTime').value=''; renderMeds(); toast('Medication added'); });
function renderMeds(){ const ul=$('#medList'); ul.innerHTML=''; if(!state.meds.length){ ul.innerHTML='<li class="text-sm text-slate-500">No meds set.</li>'; return } state.meds.forEach((m,i)=>{ const li=document.createElement('li'); li.className='flex items-center justify-between rounded-xl border p-2'; li.innerHTML=`<div><div class="text-sm font-medium">${m.name}</div><div class="text-xs text-slate-600">${m.time}</div></div><div class="flex gap-2"><button class="px-2 py-1 rounded border text-xs" data-del="${i}">Remove</button></div>`; ul.appendChild(li); }); ul.querySelectorAll('button[data-del]').forEach(btn=>btn.addEventListener('click',()=>{ const i=+btn.dataset.del; state.meds.splice(i,1); save(); renderMeds(); toast('Removed'); })); }
$('#addAppt').addEventListener('click',()=>{ const name=$('#apptName').value.trim(); const date=$('#apptDate').value; if(!name||!date){ toast('Enter appointment and date'); return } state.appts.push({id:crypto.randomUUID(),name,date}); save(); $('#apptName').value=''; $('#apptDate').value=''; renderAppts(); toast('Appointment added'); });
function renderAppts(){ const ul=$('#apptList'); ul.innerHTML=''; if(!state.appts.length){ ul.innerHTML='<li class="text-sm text-slate-500">No appointments.</li>'; return } state.appts.forEach((a,i)=>{ const li=document.createElement('li'); li.className='flex items-center justify-between rounded-xl border p-2'; li.innerHTML=`<div><div class="text-sm font-medium">${a.name}</div><div class="text-xs text-slate-600">${a.date}</div></div><div class="flex gap-2"><button class="px-2 py-1 rounded border text-xs" data-del="${i}">Remove</button></div>`; ul.appendChild(li); }); ul.querySelectorAll('button[data-del]').forEach(btn=>btn.addEventListener('click',()=>{ const i=+btn.dataset.del; state.appts.splice(i,1); save(); renderAppts(); toast('Removed'); })); }

// Today list
function renderToday(){ const wrap = $('#todayList'); wrap.innerHTML=''; const today = new Date().toISOString().slice(0,10); const appts=state.appts.filter(a=>a.date===today); const meds=state.meds; if(!appts.length && !meds.length){ wrap.innerHTML='<div class="text-sm text-slate-500">No items for today.</div>'; return } appts.forEach(a=>{ const d=document.createElement('div'); d.className='rounded-xl border p-2 bg-white'; d.innerHTML=`<div class="text-sm font-medium">${a.name}</div><div class="text-xs text-slate-600">Appointment ‚Ä¢ ${a.date}</div>`; wrap.appendChild(d); }); meds.forEach(m=>{ const d=document.createElement('div'); d.className='rounded-xl border p-2 bg-white'; d.innerHTML=`<div class="text-sm font-medium">${m.name}</div><div class="text-xs text-slate-600">Med ‚Ä¢ ${m.time}</div>`; wrap.appendChild(d); }); }

// Symptom quick check (placeholder logic)
$('#symCheck').addEventListener('click',()=>{ const q=$('#symInput').value.toLowerCase(); if(!q){ $('#symResult').textContent='Type symptoms to get quick advice.'; return } if(q.includes('fever')||q.includes('cough')) $('#symResult').textContent='Possible infection signs. Consider testing and contact clinic if severe.'; else if(q.includes('headache')) $('#symResult').textContent='Hydration, rest, and OTC pain relief may help. Seek care if severe.'; else $('#symResult').textContent='If symptoms persist, contact a health provider.'; });

// Resources (sample)
const RESOURCES = [ {name:'Oak City Cares',type:'shelter',area:'Raleigh',phone:'919-123-1000',address:'1430 S Wilmington St'}, {name:'Urban Ministries Clinic',type:'clinic',area:'Raleigh',phone:'919-123-2000'}, {name:'Inter-Faith Food Shuttle',type:'food',area:'Raleigh',phone:'919-123-3000'}, {name:'Alliance Health',type:'mental',area:'Durham',phone:'800-510-9132'}, {name:'Duke Outpatient',type:'clinic',area:'Durham',phone:'919-684-8111'}, {name:'UNC Crisis Line',type:'mental',area:'Chapel Hill',phone:'984-974-5217'} ];
function renderResources(){ const q=$('#resSearch').value.toLowerCase(); const t=$('#resType').value; const a=$('#resArea').value; const wrap=$('#resList'); wrap.innerHTML=''; RESOURCES.filter(r=>(!t||r.type===t)&&(!a||r.area===a)&&(r.name.toLowerCase().includes(q)|| (r.address||'').toLowerCase().includes(q))).forEach(r=>{ const card=document.createElement('div'); card.className='rounded-2xl border p-4 bg-white flex flex-col'; card.innerHTML = `<div class="flex items-center justify-between"><div class="text-base font-semibold">${r.name}</div><span class="text-xs px-2 py-1 rounded border text-slate-600">${r.type}</span></div><div class="text-sm text-slate-600 mt-1">${r.address||''} ‚Ä¢ ${r.area}</div><div class="mt-3 flex gap-2"><a class="px-3 py-2 rounded-xl border text-sm" href="tel:${r.phone}">Call</a><a class="px-3 py-2 rounded-xl border text-sm" target="_blank" href="#">Website</a></div>`; wrap.appendChild(card); }); }

// Check-in timer
let countdown, endAt=0; function tick(){ if(!endAt){ $('#timeLeft').textContent='‚Äî'; return } const ms=Math.max(0,endAt-Date.now()); const mins=String(Math.floor(ms/60000)).padStart(2,'0'); const secs=String(Math.floor((ms%60000)/1000)).padStart(2,'0'); $('#timeLeft').textContent = `${mins}:${secs}`; if(ms<=0){ clearInterval(countdown); endAt=0; $('#timeLeft').textContent='Missed check‚Äëin! Preparing SMS‚Ä¶'; sendSOS(false); } }
$('#startTimer').addEventListener('click',()=>{ const m=parseInt($('#mins').value)||15; endAt=Date.now()+m*60000; clearInterval(countdown); countdown=setInterval(tick,500); tick(); toast('Timer started'); }); $('#cancelTimer').addEventListener('click',()=>{ clearInterval(countdown); endAt=0; tick(); toast('Timer canceled'); });

// Settings sync
function syncSettingsUI(){ $('#privacyLoc').checked = !!state.settings.privacyLoc; $('#requireHold').checked = !!state.settings.requireHold; $('#autoSms').checked = !!state.settings.autoSms; $('#district').value = state.settings.district || 'NC-02'; }
['privacyLoc','requireHold','autoSms','district'].forEach(id=>{ const el=$('#'+id); el.addEventListener('change', e=>{ let v = (el.type==='checkbox')? el.checked : el.value; state.settings[id]=v; save(); }); });
$('#resetApp').addEventListener('click',()=>{ if(confirm('Clear local data?')){ localStorage.removeItem(storeKey); location.reload(); } });

// Shortcuts
$('#goMeds').addEventListener('click',()=> $$('.tab')[3].click());
$('#findClinic').addEventListener('click',()=>{ toast('Opening resources'); $$('.tab')[6].click(); });
$('#callCrisis').addEventListener('click',()=>{ window.location.href='tel:800-510-9132' });
$('#bookRide').addEventListener('click',()=>{ toast('Request ride via local provider'); });

// Init
window.addEventListener('DOMContentLoaded',()=>{ initMap(); initReportMap(); initRouteMap(); renderContacts(); renderRecent(); renderMeds(); renderAppts(); renderResources(); renderToday(); renderMood(); syncSettingsUI(); });

// Tiny selectors
function $(q){ return document.querySelector(q); }
function $$(q){ return document.querySelectorAll(q); }
</script>
</body>
</html>
